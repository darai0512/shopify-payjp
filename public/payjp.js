/*! Thu Jul 26 2018 08:06:27 GMT+0000 (Coordinated Universal Time) */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);window.Payjp=new i.default({apiURL:"http://0.0.0.0:8000",applePayMerchantId:"merchant.jp.pay.production"})},function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=n(4),o=n(5),u={apiURL:"http://0.0.0.0:8000",applePayMerchantId:"merchant.jp.pay.production"},s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.transport=new a.default(t.apiURL||u.apiURL),this.validate=new r.default,this.applePay=new o.default(this,t.applePayMerchantId||u.applePayMerchantId),this._publicKey="",this._lang="ja"}return i(e,[{key:"setPublicKey",value:function(e){this._publicKey=e}},{key:"getPublicKey",value:function(){return this._publicKey}},{key:"setLanguage",value:function(e){this._lang=e}},{key:"getLanguage",value:function(){return this._lang}},{key:"hasPublicKey",value:function(){if(""===this.getPublicKey())throw new Error("Public key 縺後そ繝�ヨ縺輔ｌ縺ｦ縺�∪縺帙ｓ");return!0}},{key:"retrieveAvailability",value:function(e){this.hasPublicKey()&&this.transport.callAPI("GET","accounts/brands",{},this.getPublicKey(),e)}},{key:"createToken",value:function(e,t,n){if("function"==typeof t&&(n=t),this.hasPublicKey()){var i={card:e};this.transport.callAPI("POST","tokens",i,this.getPublicKey(),n)}}},{key:"getToken",value:function(e,t){this.hasPublicKey()&&this.transport.callAPI("GET","tokens/"+e,{},this.getPublicKey(),t)}}]),e}();t.default=s},function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=new(n(3).default),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiURL=t||"http://0.0.0.0:8000",this.iframe=null,this.ok=!1,this.initializedCallback=!1,this.callCount=0,this.messageQueue=[],this.callbackQueue={},this.timeoutQueue={}}return i(e,[{key:"onMessage",value:function(e){var t,n=e.id;t=null===e.response||""===e.response?{error:{description:"Token 繧貞叙蠕励〒縺阪∪縺帙ｓ"}}:JSON.parse(e.response),this.callbackQueue[n](parseInt(e.status,10),t),window.clearTimeout(this.timeoutQueue[n]),delete this.callbackQueue[n],delete this.timeoutQueue[n]}},{key:"processMessages",value:function(){var e=this;if(this.iframe){for(var t=function(){var t=e.messageQueue[n];e.callbackQueue[t.message.id]=t.callback,a.postMessage(t.message,e.apiURL,e.iframeSrc,e.iframe),e.timeoutQueue[t.message.id]=setTimeout(function(){e.callbackQueue[t.message.id](504,{error:{description:"Token 繧貞叙蠕励〒縺阪∪縺帙ｓ"}}),delete e.callbackQueue[t.message.id],delete e.timeoutQueue[t.message.id]},6e3)},n=0;n<this.messageQueue.length;n++)t();this.messageQueue=[]}}},{key:"initIframe",value:function(){var e=this,t=document.createElement("iframe"),n="payjpFrame"+(new Date).getTime(),i=this.apiURL+"/v1/js/apitunnel.html#"+encodeURIComponent(window.location.href);t.setAttribute("src",i),t.setAttribute("name",n),t.setAttribute("id","payjpFrame"),t.setAttribute("frameborder","0"),t.setAttribute("scrolling","no"),t.setAttribute("allowtransparency","true"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("style","position:absolute;top:0;left:0;width:0;height:0");var a=function(){e.iframe=window.frames[n],e.processMessages()};t.attachEvent?t.attachEvent("onload",a):t.onload=a,document.getElementsByTagName("body")[0].appendChild(t)}},{key:"setupIframe",value:function(){null===document.getElementById("payjpFrame")&&this.initIframe(),this.initializedCallback||(a.receiveMessage(this.onMessage.bind(this),this.apiURL),this.initializedCallback=!0)}},{key:"init",value:function(){this.iframeName&&document.getElementById(this.iframeName)||("undefined"!=typeof document&&document&&document.body?this.setupIframe():"undefined"!=typeof window&&window&&!this.ok&&(window.attachEvent?window.attachEvent("onload",this.setupIframe):window.addEventListener("load",this.setupIframe,!1))),this.ok=!0}},{key:"callAPI",value:function(e,t,n,i,a){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"/v1/",u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if("GET"!==e&&"POST"!==e&&"DELETE"!==e)throw new Error("謖�ｮ壹〒縺阪ｋ HTTP 繝｡繧ｽ繝�ラ縺ｯ GET, POST, DELETE 縺ｮ縺ｿ縺ｧ縺�");this.init();var s=(this.callCount++).toString();this.messageQueue.push({message:{id:s,method:e,url:o+t,params:n,key:i,keyType:r,locale:u},callback:a}),this.processMessages()}}]),e}();t.default=r},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,[{key:"_serialize",value:function(e,t){var n=[];for(var a in e)if(e.hasOwnProperty(a)){var r=t?t+"["+a+"]":a,o=e[a];"object"===(void 0===o?"undefined":i(o))?n.push(this._serialize(o,r)):n.push(encodeURIComponent(r)+"="+encodeURIComponent(o))}return n.join("&")}},{key:"_deserialize",value:function(e){for(var t={},n=e.split("&"),i=n.length,a=0;a<i;){var r=n[a].split("=");r[0]=decodeURIComponent(r[0]),r[1]=decodeURIComponent(r[1]);for(var o=r[0],u=[],s=-1;-1!==(s=o.indexOf("["));)u.push(o.substr(s,o.indexOf("]")-s+1)),o=o.substr(o.indexOf("]")+1);if(0===u.length)t[r[0]]=r[1];else{void 0===t[s=r[0].substr(0,r[0].indexOf("["))]&&(t[s]={}),o=t[s];for(var l=u.length,c=0;c<l-1;)void 0===o[s=u[c].substr(1,u[c].length-2)]&&(o[s]={}),o=o[s],++c;o[s=(u=u[l-1]).substr(1,u.length-2)]=r[1]}++a}return t}},{key:"receiveMessage",value:function(e,t){var n=this;if("undefined"!=typeof window)if(void 0!==window.postMessage){var i=function(i){if(i.origin.toLowerCase()!==t.toLowerCase())return!1;e(n._deserialize(i.data))};window.addEventListener?window.addEventListener("message",i,!1):window.attachEvent("onmessage",i)}else{var a=window.location.hash;setInterval(function(){var t=window.location.hash,i=/^#?\d+&/;t!==a&&i.test(t)&&(a=t,window.location.hash="",e(n._deserialize(t.replace(i,""))))},100)}}},{key:"postMessage",value:function(e,t,n,i){if("undefined"!=typeof window)if(e=this._serialize(e),void 0===window.postMessage){var a=n+"#"+(+new Date+Math.floor(1e3*Math.random()))+"&"+e;i.location.href=a}else i.postMessage(e,t)}}]),e}();t.default=r},function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"cardNumber",value:function(e){if(!e)return!1;var t=(e+"").replace(/\s+|-/g,"");return!!(t.length>=14&&t.length<=16&&this.luhnCheck(t))}},{key:"luhnCheck",value:function(e){for(var t=!0,n=0,i=(e+"").split("").reverse(),a=0,r=i.length;a<r;a++){var o=i[a],u=parseInt(o,10);(t=!t)&&(u*=2),u>9&&(u-=9),n+=u}return n%10==0}},{key:"expiry",value:function(e,t){if(!e||!t)return!1;var n=this.trimNumber(e),i=this.trimNumber(t);if(/^\d+$/.test(n)&&/^\d+$/.test(i)&&parseInt(n,10)<=12){var a=new Date(parseInt(i,10),parseInt(n,10)),r=new Date;if(a.setMonth(a.getMonth()-1),a.setMonth(a.getMonth()+1,1),a>r)return!0}return!1}},{key:"cvc",value:function(e){var t=this.trimNumber(e);return!!(/^\d+$/.test(t)&&t.length>=3&&t.length<=4)}},{key:"name",value:function(e){return!!e&&this.trim(e).length>0}},{key:"trim",value:function(e){return String(e).replace(/(^\s+)|(\s+$)/g,"")}},{key:"trimNumber",value:function(e){return(e+"").replace(/^\s+|\s+$/g,"")}},{key:"cardType",value:function(e){if(!e)return"Unknown";for(var t=String(e),n={},i=void 0,a=i=40;i<=49;)n[a]="Visa",a=++i;var r=void 0;for(a=r=50;r<=59;)n[a]="MasterCard",a=++r;return n[34]=n[37]="American Express",n[60]=n[62]=n[64]=n[65]="Discover",n[35]="JCB",n[30]=n[36]=n[38]=n[39]="Diners Club",n[t.slice(0,2)]||"Unknown"}}]),e}();t.default=a},function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a={Visa:"visa",MasterCard:"masterCard",JCB:"jcb","American Express":"amex",Discover:null,"Diners Club":null},r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.payjp=t,this.merchantId=n}return i(e,[{key:"isOverHTTPS",value:function(){return"http:"===window.location.protocol}},{key:"_fetchMerchantId",value:function(e){this.payjp.transport.callAPI("GET","accounts/apple_pay/partner_internal_merchant_identifier",{},this.payjp.getPublicKey(),e)}},{key:"checkAvailability",value:function(e){var t=this;if(null===e)throw new Error("蠑墓焚縺ｫ繧ｳ繝ｼ繝ｫ繝舌ャ繧ｯ髢｢謨ｰ繧呈欠螳壹＠縺ｦ縺上□縺輔＞");this.isOverHTTPS()&&"undefined"!=typeof ApplePaySession&&ApplePaySession.canMakePayments()?Promise.all([new Promise(function(e,n){t.payjp.retrieveAvailability(function(t,i){200!==t?n(i):e(i)})}),new Promise(function(e,n){t._fetchMerchantId(function(i,a){200!==i&&n(a),"merchant_id"in a&&(t.merchantId=a.merchant_id),e(t.merchantId)})}).then(function(e){return ApplePaySession.canMakePaymentsWithActiveCard(e)})]).then(function(n){if(t._supportedNetworks=n[0].card_types_supported.map(function(e){return a[e]}).filter(function(e){return e}),0===t._supportedNetworks.length)throw new Error("蛻ｩ逕ｨ蜿ｯ閭ｽ縺ｪ繧ｫ繝ｼ繝峨ヶ繝ｩ繝ｳ繝峨′縺ゅｊ縺ｾ縺帙ｓ");e(n[1])}).catch(function(t){e(!1)}):e(!1)}},{key:"setDisplayName",value:function(e){this.displayName=e}},{key:"_startSession",value:function(e,t){var n={domain:window.location.host,validation_url:e,display_name:this.displayName||window.location.host};this.payjp.transport.callAPI("POST","accounts/apple_pay/sessions",n,this.payjp.getPublicKey(),t)}},{key:"buildSession",value:function(e,t,n){var i=this;if(null===t||null===n)throw new Error("蠑墓焚縺ｫ繧ｳ繝ｼ繝ｫ繝舌ャ繧ｯ髢｢謨ｰ繧呈欠螳壹＠縺ｦ縺上□縺輔＞");e.merchantCapabilities=["supports3DS"],e.supportedNetworks=this._supportedNetworks||["amex","discover","jcb","masterCard","visa"];var a=new ApplePaySession(2,e);return a.onvalidatemerchant=function(e){i._startSession(e.validationURL,function(e,t){if(200!==e)return a.completeMerchantValidation({}),void n(t);a.completeMerchantValidation(t)})},a.onpaymentauthorized=function(e){var r=e.payment;i.payjp.createToken(encodeURI(JSON.stringify(r.token.paymentData)),function(e,i){200===e?(r.token=i,t(r)):(a.completePayment(ApplePaySession.STATUS_FAILURE),n(i))})},a}}]),e}();t.default=r}]);
